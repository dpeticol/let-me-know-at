// Generated by CoffeeScript 1.3.3
(function() {
  var hourString, meridiumString, minuteString, target, timeAdd, timeString, today;

  today = new Date();

  if (window.lmka.urlTimeAdd) {
    timeAdd = window.lmka.hours * 3600000 + window.lmka.minutes * 60000;
    target = new Date(today.getTime() + timeAdd);
  } else {
    target = new Date(today.getFullYear(), today.getMonth(), today.getDate(), window.lmka.hours, window.lmka.minutes, 0, 0);
  }

  if (target.getMinutes() < 10) {
    minuteString = "0" + (target.getMinutes());
  } else {
    minuteString = target.getMinutes();
  }

  if (target.getHours() === 0 || target.getHours() === 12) {
    hourString = '12';
  } else {
    hourString = target.getHours() % 12;
  }

  if (target.getHours() < 12) {
    meridiumString = "am";
  } else {
    meridiumString = "pm";
  }

  timeString = "" + hourString + ":" + minuteString + meridiumString;

  console.log("current time: " + today);

  console.log("target time: " + target);

  $(function() {
    var worker;
    window.document.title = timeString;
    $('.alarm-time').text(timeString);
    worker = new Worker('javascripts/webworker.js');
    worker.onmessage = function(e) {
      var reminderText;
      reminderText = $('.reminder').val();
      if (reminderText === "") {
        alert("Letting you know that it's now " + timeString + "!");
      } else {
        alert("Letting you know, it's not " + timeString + "!]\n" + reminderText);
      }
      return worker.terminate();
    };
    return worker.postMessage(target.getTime());
  });

}).call(this);
